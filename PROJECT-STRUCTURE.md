# é¡¹ç›®ç»“æ„è¯´æ˜

```
/root/test/
â”‚
â”œâ”€â”€ ğŸ“‚ backend/                          # Goåç«¯æœåŠ¡
â”‚   â”œâ”€â”€ cmd/server/
â”‚   â”‚   â””â”€â”€ main.go                     # åº”ç”¨å…¥å£ï¼Œåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡
â”‚   â”œâ”€â”€ internal/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ handlers/               # HTTPè¯·æ±‚å¤„ç†å™¨
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ rules.go           # è§„åˆ™CRUD API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ stats.go           # ç»Ÿè®¡API
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ history.go         # å†å²è®°å½•API
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ websocket.go       # WebSocketæ¨é€
â”‚   â”‚   â”‚   â”œâ”€â”€ middleware/             # ä¸­é—´ä»¶
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ cors.go            # CORSå¤„ç†
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ logger.go          # è¯·æ±‚æ—¥å¿—
â”‚   â”‚   â”‚   â””â”€â”€ router.go               # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ service/                    # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ iptables.go            # è§„åˆ™è§£æå’Œæœç´¢
â”‚   â”‚   â”‚   â””â”€â”€ stats.go                # ç»Ÿè®¡è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ repository/                 # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ database.go            # SQLiteåˆå§‹åŒ–
â”‚   â”‚   â”‚   â””â”€â”€ history.go              # å†å²è®°å½•å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ executor/                   # å‘½ä»¤æ‰§è¡Œå±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ iptables.go            # iptableså‘½ä»¤æ‰§è¡Œ
â”‚   â”‚   â”‚   â””â”€â”€ validator.go           # è¾“å…¥éªŒè¯ï¼ˆé˜²æ³¨å…¥ï¼‰
â”‚   â”‚   â””â”€â”€ models/                     # æ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ rule.go                # è§„åˆ™æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ stats.go               # ç»Ÿè®¡æ¨¡å‹
â”‚   â”‚       â””â”€â”€ history.go              # å†å²æ¨¡å‹
â”‚   â”œâ”€â”€ go.mod                          # Goä¾èµ–ç®¡ç†
â”‚   â””â”€â”€ go.sum
â”‚
â”œâ”€â”€ ğŸ“‚ frontend/                         # Reactå‰ç«¯åº”ç”¨
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/                 # Reactç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Rules/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RuleList.tsx       # è§„åˆ™åˆ—è¡¨ï¼ˆè¡¨æ ¼+åŠ¨ç”»ï¼‰
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ RuleForm.tsx       # æ·»åŠ è§„åˆ™è¡¨å•
â”‚   â”‚   â”‚   â””â”€â”€ Statistics/
â”‚   â”‚   â”‚       â””â”€â”€ LiveStats.tsx       # å®æ—¶ç»Ÿè®¡å¡ç‰‡
â”‚   â”‚   â”œâ”€â”€ store/                      # ReduxçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ store.ts               # Storeé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ slices/
â”‚   â”‚   â”‚       â”œâ”€â”€ rulesSlice.ts      # è§„åˆ™çŠ¶æ€
â”‚   â”‚   â”‚       â””â”€â”€ statsSlice.ts      # ç»Ÿè®¡çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ services/                   # APIæœåŠ¡å±‚
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                 # Axiosé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ rulesApi.ts            # è§„åˆ™API
â”‚   â”‚   â”‚   â”œâ”€â”€ statsApi.ts            # ç»Ÿè®¡API
â”‚   â”‚   â”‚   â””â”€â”€ historyApi.ts          # å†å²API
â”‚   â”‚   â”œâ”€â”€ hooks/                      # è‡ªå®šä¹‰Hooks
â”‚   â”‚   â”‚   â””â”€â”€ useWebSocket.ts         # WebSocket Hook
â”‚   â”‚   â”œâ”€â”€ types/                      # TypeScriptç±»å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ rule.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ stats.ts
â”‚   â”‚   â”‚   â””â”€â”€ history.ts
â”‚   â”‚   â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ formatters.ts          # æ ¼å¼åŒ–å‡½æ•°
â”‚   â”‚   â”‚   â””â”€â”€ websocket.ts           # WebSocket URLç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ App.tsx                     # ä¸»åº”ç”¨ç»„ä»¶
â”‚   â”‚   â””â”€â”€ index.tsx                   # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json                    # npmä¾èµ–ç®¡ç†
â”‚   â””â”€â”€ tsconfig.json                   # TypeScripté…ç½®
â”‚
â”œâ”€â”€ ğŸ“‚ docker/                          # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile.backend              # åç«¯é•œåƒï¼ˆAlpine+Goï¼‰
â”‚   â”œâ”€â”€ Dockerfile.frontend             # å‰ç«¯é•œåƒï¼ˆAlpine+Nginxï¼‰
â”‚   â””â”€â”€ nginx.conf                      # Nginxé…ç½®ï¼ˆåå‘ä»£ç†ï¼‰
â”‚
â”œâ”€â”€ ğŸ“‚ scripts/                         # è¾…åŠ©è„šæœ¬
â”‚   â”œâ”€â”€ setup.sh                       # ä¾èµ–å®‰è£…è„šæœ¬
â”‚   â””â”€â”€ run-dev.sh                     # å¼€å‘ç¯å¢ƒå¯åŠ¨è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“‚ data/                            # æ•°æ®æŒä¹…åŒ–ç›®å½•
â”‚   â””â”€â”€ iptables.db                    # SQLiteæ•°æ®åº“ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
â”‚
â”œâ”€â”€ ğŸ“„ docker-compose.yml               # Docker Composeé…ç½®
â”œâ”€â”€ ğŸ“„ docker-start.sh                  # Dockerä¸€é”®å¯åŠ¨
â”œâ”€â”€ ğŸ“„ docker-stop.sh                   # Dockeråœæ­¢è„šæœ¬
â”‚
â”œâ”€â”€ ğŸ“– README.md                        # å®Œæ•´é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ ğŸ“– DOCKER-README.md                 # Dockeréƒ¨ç½²è¯¦ç»†è¯´æ˜
â”œâ”€â”€ ğŸ“– QUICKSTART.md                    # å¿«é€Ÿä¸Šæ‰‹æŒ‡å—
â”œâ”€â”€ ğŸ“– START.md                         # ä¸€é”®å¯åŠ¨è¯´æ˜
â””â”€â”€ ğŸ“– PROJECT-STRUCTURE.md             # æœ¬æ–‡ä»¶

```

## æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### åç«¯å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ | é‡è¦æ€§ |
|------|------|--------|
| `cmd/server/main.go` | åº”ç”¨å¯åŠ¨å…¥å£ï¼Œåˆå§‹åŒ–æ‰€æœ‰ç»„ä»¶ | â­â­â­â­â­ |
| `executor/iptables.go` | æ‰§è¡Œiptableså‘½ä»¤ï¼Œç³»ç»Ÿäº¤äº’æ ¸å¿ƒ | â­â­â­â­â­ |
| `executor/validator.go` | è¾“å…¥éªŒè¯ï¼Œé˜²æ­¢å‘½ä»¤æ³¨å…¥ | â­â­â­â­â­ |
| `service/iptables.go` | è§£æiptablesè¾“å‡ºï¼Œä¸šåŠ¡é€»è¾‘ | â­â­â­â­ |
| `handlers/websocket.go` | WebSocketå®æ—¶æ¨é€ | â­â­â­â­ |
| `repository/database.go` | æ•°æ®åº“ç®¡ç† | â­â­â­ |

### å‰ç«¯å…³é”®æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ | é‡è¦æ€§ |
|------|------|--------|
| `App.tsx` | ä¸»åº”ç”¨å¸ƒå±€å’Œè·¯ç”± | â­â­â­â­â­ |
| `store/slices/rulesSlice.ts` | è§„åˆ™çŠ¶æ€ç®¡ç†ï¼ŒReduxæ ¸å¿ƒ | â­â­â­â­â­ |
| `components/Rules/RuleList.tsx` | è§„åˆ™åˆ—è¡¨å±•ç¤ºï¼Œä¸»ç•Œé¢ | â­â­â­â­ |
| `hooks/useWebSocket.ts` | WebSocketè¿æ¥ç®¡ç† | â­â­â­â­ |
| `services/api.ts` | APIé…ç½®ï¼Œç¯å¢ƒé€‚é… | â­â­â­â­ |

### Dockerç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `docker-compose.yml` | æœåŠ¡ç¼–æ’é…ç½® |
| `docker/Dockerfile.backend` | åç«¯é•œåƒæ„å»º |
| `docker/Dockerfile.frontend` | å‰ç«¯é•œåƒæ„å»º |
| `docker/nginx.conf` | åå‘ä»£ç†é…ç½® |
| `docker-start.sh` | ä¸€é”®å¯åŠ¨è„šæœ¬ |

## æŠ€æœ¯æ ˆæ€»è§ˆ

### åç«¯æŠ€æœ¯
- **è¯­è¨€**: Go 1.21+
- **Webæ¡†æ¶**: Gorilla Mux
- **WebSocket**: Gorilla WebSocket
- **æ•°æ®åº“**: SQLite3
- **å®¹å™¨**: Alpine Linux

### å‰ç«¯æŠ€æœ¯
- **æ¡†æ¶**: React 18 + TypeScript
- **çŠ¶æ€ç®¡ç†**: Redux Toolkit
- **UIåº“**: Ant Design
- **åŠ¨ç”»**: Framer Motion
- **å›¾è¡¨**: Recharts
- **HTTP**: Axios
- **æ„å»º**: Create React App
- **WebæœåŠ¡å™¨**: Nginx (ç”Ÿäº§)

### å¼€å‘å·¥å…·
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åŒ…ç®¡ç†**: Go Modules + npm
- **ä»£ç è§„èŒƒ**: TypeScript + Go fmt

## æ•°æ®æµå›¾

```
ç”¨æˆ·æµè§ˆå™¨
    â†“
Nginx (Docker)
    â”œâ”€â†’ /api/* â†’ Backend (Go)
    â”‚              â†“
    â”‚         iptableså‘½ä»¤
    â”‚              â†“
    â”‚         SQLiteæ•°æ®åº“
    â”‚
    â”œâ”€â†’ /ws/* â†’ WebSocket
    â”‚              â†“
    â”‚         å®æ—¶æ¨é€
    â”‚
    â””â”€â†’ /* â†’ Reacté™æ€æ–‡ä»¶
```

## ç«¯å£ä½¿ç”¨

| æœåŠ¡ | å¼€å‘ç«¯å£ | Dockerç«¯å£ |
|------|---------|-----------|
| å‰ç«¯ | 3000 | 80 |
| åç«¯ | 8080 | 8080 (hostæ¨¡å¼) |
| WebSocket | 8080 | 80 (é€šè¿‡Nginx) |

## ç¯å¢ƒæ¨¡å¼

### å¼€å‘ç¯å¢ƒ
- å‰ç«¯: React Dev Server (localhost:3000)
- åç«¯: ç›´æ¥è¿è¡Œ (localhost:8080)
- API: http://localhost:8080/api/v1
- WebSocket: ws://localhost:8080/ws/*

### ç”Ÿäº§ç¯å¢ƒï¼ˆDockerï¼‰
- å‰ç«¯: Nginx (localhost:80)
- åç«¯: Dockerå®¹å™¨ (hostç½‘ç»œ)
- API: /api/v1 (é€šè¿‡Nginxä»£ç†)
- WebSocket: /ws/* (é€šè¿‡Nginxä»£ç†)

## å®‰å…¨å±‚çº§

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. Nginxåå‘ä»£ç†                    â”‚
â”‚     - CORSé…ç½®                       â”‚
â”‚     - è¯·æ±‚é™æµ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. APIä¸­é—´ä»¶                        â”‚
â”‚     - è¯·æ±‚æ—¥å¿—                       â”‚
â”‚     - é”™è¯¯å¤„ç†                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. è¾“å…¥éªŒè¯å™¨                       â”‚
â”‚     - ç™½åå•æ£€æŸ¥                     â”‚
â”‚     - å‘½ä»¤æ³¨å…¥é˜²æŠ¤                   â”‚
â”‚     - IP/ç«¯å£éªŒè¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. iptablesæ‰§è¡Œå™¨                   â”‚
â”‚     - Rootæƒé™æ£€æŸ¥                   â”‚
â”‚     - å‘½ä»¤æ‰§è¡Œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. å®¡è®¡æ—¥å¿—                         â”‚
â”‚     - SQLiteæŒä¹…åŒ–                   â”‚
â”‚     - æ“ä½œè®°å½•                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¼€å‘æµç¨‹

1. **æœ¬åœ°å¼€å‘**: ä¿®æ”¹ä»£ç  â†’ è‡ªåŠ¨çƒ­é‡è½½
2. **æµ‹è¯•**: æ‰‹åŠ¨æµ‹è¯•åŠŸèƒ½
3. **Dockeræ„å»º**: `docker-compose build`
4. **Dockerè¿è¡Œ**: `docker-compose up -d`
5. **éªŒè¯**: è®¿é—® http://localhost

## æ€§èƒ½æŒ‡æ ‡

- **åç«¯å“åº”æ—¶é—´**: < 100ms (è§„åˆ™åˆ—è¡¨)
- **WebSocketæ¨é€é¢‘ç‡**: ç»Ÿè®¡2ç§’ï¼Œè§„åˆ™5ç§’
- **å‰ç«¯åŠ è½½æ—¶é—´**: < 2ç§’ (é¦–æ¬¡)
- **é•œåƒå¤§å°**: åç«¯~30MB, å‰ç«¯~25MB
- **å†…å­˜å ç”¨**: åç«¯~50MB, å‰ç«¯~20MB
